<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Bookstore Inventory CRUD</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    form { margin-bottom: 20px; }
    label { display: block; margin-top: 8px; }
    input { padding: 4px; width: 250px; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 6px 8px; text-align: left; }
    th { background: #f4f4f4; }
    .actions button { margin-right: 4px; }
    .error { color: #b00020; margin-top: 8px; }
    .success { color: #006400; margin-top: 8px; }
  </style>
</head>
<body>

  <h1>Inventory Management</h1>

  <form id="bookForm">
    <input type="hidden" id="bookId" />
    <label>
      Title:
      <input type="text" id="title" required />
    </label>
    <label>
      Author:
      <input type="text" id="author" required />
    </label>
    <label>
      ISBN:
      <input type="text" id="isbn" required />
    </label>
    <label>
      Price:
      <input type="number" step="0.01" id="price" required />
    </label>
    <label>
      Quantity:
      <input type="number" step="1" id="quantity" required />
    </label>

    <button type="submit" id="submitBtn">Add Book</button>
    <button type="button" id="cancelEditBtn" style="display:none;">Cancel Edit</button>

    <div id="message"></div>
  </form>

  <h2>Current Inventory</h2>
  <table>
    <thead>
      <tr>
        <th>Title</th>
        <th>Author</th>
        <th>ISBN</th>
        <th>Price ($)</th>
        <th>Quantity</th>
        <th>Stock Value ($)</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="inventoryBody">
      <!-- Rows added dynamically -->
    </tbody>
  </table>

  <script>
    // In-memory inventory (would be API-backed in a real app)
    let inventory = [];
    let editingId = null; // null means "add" mode, not editing

    const bookForm = document.getElementById('bookForm');
    const bookIdInput = document.getElementById('bookId');
    const titleInput = document.getElementById('title');
    const authorInput = document.getElementById('author');
    const isbnInput = document.getElementById('isbn');
    const priceInput = document.getElementById('price');
    const quantityInput = document.getElementById('quantity');
    const submitBtn = document.getElementById('submitBtn');
    const cancelEditBtn = document.getElementById('cancelEditBtn');
    const messageDiv = document.getElementById('message');
    const inventoryBody = document.getElementById('inventoryBody');

    function showMessage(text, type = 'error') {
      messageDiv.textContent = text;
      messageDiv.className = type === 'error' ? 'error' : 'success';
      if (!text) {
        messageDiv.className = '';
      }
    }

    // Basic validation, including unique ISBN
    function validateForm() {
      const title = titleInput.value.trim();
      const author = authorInput.value.trim();
      const isbn = isbnInput.value.trim();
      const price = parseFloat(priceInput.value);
      const quantity = parseInt(quantityInput.value, 10);

      if (!title || !author || !isbn) {
        showMessage('Title, Author, and ISBN are required.', 'error');
        return false;
      }
      if (isNaN(price) || price <= 0) {
        showMessage('Price must be a positive number.', 'error');
        return false;
      }
      if (isNaN(quantity) || quantity < 0) {
        showMessage('Quantity must be 0 or a positive integer.', 'error');
        return false;
      }

      // Unique ISBN check (only for new entries or changed ISBN in edit)
      const existing = inventory.find(b => b.isbn === isbn);
      if (existing && existing.id !== editingId) {
        showMessage('A book with this ISBN already exists.', 'error');
        return false;
      }

      return true;
    }

    function clearForm() {
      bookIdInput.value = '';
      titleInput.value = '';
      authorInput.value = '';
      isbnInput.value = '';
      priceInput.value = '';
      quantityInput.value = '';
      editingId = null;
      submitBtn.textContent = 'Add Book';
      cancelEditBtn.style.display = 'none';
      showMessage('');
    }

    // Render the inventory table (instant stock sync)
    function renderInventory() {
      inventoryBody.innerHTML = '';

      inventory.forEach(book => {
        const tr = document.createElement('tr');

        const stockValue = (book.price * book.quantity).toFixed(2);

        tr.innerHTML = `
          <td>${book.title}</td>
          <td>${book.author}</td>
          <td>${book.isbn}</td>
          <td>${book.price.toFixed(2)}</td>
          <td>${book.quantity}</td>
          <td>${stockValue}</td>
          <td class="actions">
            <button type="button" data-id="${book.id}" class="editBtn">Edit</button>
            <button type="button" data-id="${book.id}" class="deleteBtn">Delete</button>
          </td>
        `;

        inventoryBody.appendChild(tr);
      });
    }

    // Handle Add / Update
    bookForm.addEventListener('submit', function (e) {
      e.preventDefault();

      if (!validateForm()) return;

      const title = titleInput.value.trim();
      const author = authorInput.value.trim();
      const isbn = isbnInput.value.trim();
      const price = parseFloat(priceInput.value);
      const quantity = parseInt(quantityInput.value, 10);

      if (editingId === null) {
        // ADD
        const newBook = {
          id: Date.now(), // simple unique ID
          title,
          author,
          isbn,
          price,
          quantity
        };
        inventory.push(newBook);
        showMessage('Book added successfully.', 'success');
      } else {
        // UPDATE
        const index = inventory.findIndex(b => b.id === editingId);
        if (index !== -1) {
          inventory[index] = {
            ...inventory[index],
            title,
            author,
            isbn,
            price,
            quantity
          };
          showMessage('Book updated successfully.', 'success');
        }
      }

      renderInventory(); // instant sync
      clearForm();
    });

    // Handle Edit / Delete via event delegation
    inventoryBody.addEventListener('click', function (e) {
      const target = e.target;
      if (target.classList.contains('editBtn')) {
        const id = Number(target.getAttribute('data-id'));
        startEdit(id);
      } else if (target.classList.contains('deleteBtn')) {
        const id = Number(target.getAttribute('data-id'));
        deleteBook(id);
      }
    });

    function startEdit(id) {
      const book = inventory.find(b => b.id === id);
      if (!book) return;

      editingId = id;
      bookIdInput.value = id;
      titleInput.value = book.title;
      authorInput.value = book.author;
      isbnInput.value = book.isbn;
      priceInput.value = book.price;
      quantityInput.value = book.quantity;

      submitBtn.textContent = 'Update Book';
      cancelEditBtn.style.display = 'inline-block';
      showMessage('Editing book. Make changes and click "Update Book".', 'success');
    }

    function deleteBook(id) {
      if (!confirm('Are you sure you want to delete this book?')) return;
      inventory = inventory.filter(b => b.id !== id);
      renderInventory(); // instant sync
      showMessage('Book removed from inventory.', 'success');
      if (editingId === id) {
        clearForm();
      }
    }

    cancelEditBtn.addEventListener('click', function () {
      clearForm();
    });

    // Seed with a sample book (optional)
    inventory.push({
      id: 1,
      title: 'Sample Book',
      author: 'John Doe',
      isbn: '1234567890',
      price: 19.99,
      quantity: 10
    });
    renderInventory();
  </script>
</body>
</html>
